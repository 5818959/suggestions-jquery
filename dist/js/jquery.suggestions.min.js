/**
 * DaData.ru Suggestions jQuery plugin, version 4.3.2
 *
 * DaData.ru Suggestions jQuery plugin is freely distributable under the terms of MIT-style license
 * Built on DevBridge Autocomplete for jQuery (https://github.com/devbridge/jQuery-Autocomplete)
 * For details, see https://github.com/hflabs/suggestions-jquery
 */
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";function b(c,d){var e=function(){},f=this,g={autoSelectFirst:!1,serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:b.formatResult,delimiter:null,zIndex:9999,noCache:!1,onSearchStart:e,onSearchComplete:e,onSearchError:e,containerClass:"suggestions-suggestions",tabDisabled:!1,currentRequest:null,triggerSelectOnValidInput:!1,triggerSelectOnSpace:!0,preventBadQueries:!0,lookupFilter:function(a,b,c){return-1!==a.value.toLowerCase().indexOf(c)},paramName:"query",transformResult:function(b){return"string"==typeof b?a.parseJSON(b):b},usePreloader:!0,hint:b.defaultHint,dadataType:null};f.element=c,f.el=a(c),f.suggestions=[],f.badQueries=[],f.selectedIndex=-1,f.currentValue=f.element.value,f.intervalId=0,f.cachedResponse={},f.onChangeInterval=null,f.onChange=null,f.isLocal=!1,f.suggestionsContainer=null,f.$wrapped=null,f.$preloader=null,f.options=a.extend({},g,d),f.classes={hint:"suggestions-hint",selected:"suggestions-selected",suggestion:"suggestions-suggestion"},f.hint=null,f.hintValue="",f.selection=null,f.$viewport=a(window),f.triggeredSelectOnSpace=!1,f.skipOnFocus=!1,f.enrichService=i.default,f.dropdownDisabled=!1,f.initialize(),f.setOptions(d)}var c=function(){return{escapeRegExChars:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},createNode:function(a){var b=document.createElement("div");return b.className=a,b.style.position="absolute",b.style.display="none",b},getDefaultType:function(){return a.support.cors?"POST":"GET"},getDefaultContentType:function(){return a.support.cors?"application/json":"application/x-www-form-urlencoded"},serialize:function(b){return a.support.cors?JSON.stringify(b):a.param(b,!0)}}}(),d={ESC:27,TAB:9,RETURN:13,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40},e=".suggestions",f="suggestions",g={fieldMaps:{gender:{М:"MALE",Ж:"FEMALE",НД:"UNKNOWN"}},url:"https://dadata.ru/api/v1/clean",timeout:200,types:["NAME","ADDRESS"]},h={},i={};i["default"]={enrichSuggestion:function(b){return a.Deferred().resolve(b)},enrichResponse:function(b){return a.Deferred().resolve(b)}},i.dadata={enrichSuggestion:function(b){var c=this,d=a.trim(c.options.token),e={structure:[c.options.dadataType],data:[[b.value]]},f=a.Deferred();return b.data&&"qc"in b.data?f.resolve(b):(c.showPreloader(),c.disableDropdown(),a.ajax(g.url,{type:"POST",headers:{Authorization:"Token "+d},contentType:"application/json",dataType:"json",data:JSON.stringify(e),timeout:g.timeout}).done(function(c){var d=c.data,e=d&&d[0]&&d[0][0];e&&0===e.qc?(a.each(g.fieldMaps,function(a,b){a in e&&(e[a]=b[e[a]])}),e={value:b.value,data:e}):e=b,f.resolve(e)}).fail(function(){f.resolve(b)}).always(function(){c.hidePreloader(),c.enableDropdown()}),f)},enrichResponse:function(b,c){var d=this,e=a.trim(d.options.token),f={structure:[d.options.dadataType],data:[[c]]},h=b.suggestions||[],i=a.Deferred();return h.length?i.resolve(b):(a.ajax(g.url,{type:"POST",headers:{Authorization:"Token "+e},contentType:"application/json",dataType:"json",data:JSON.stringify(f),timeout:g.timeout}).done(function(d){var e=d.data,f=e&&e[0]&&e[0][0];f&&(a.each(g.fieldMaps,function(a,b){a in f&&(f[a]=b[f[a]])}),f={value:c,data:f},b.suggestions=[f]),i.resolve(b)}).fail(function(){i.resolve(b)}),i)}},b.utils=c,b.formatResult=function(a,b){var d="(^|\\s+)("+c.escapeRegExChars(b)+")";return a.value.replace(new RegExp(d,"gi"),"$1<strong>$2</strong>")},b.resetTokens=function(){h={}},b.defaultHint="Выберите вариант ниже или продолжите ввод",b.dadataConfig=g,a.Suggestions=b,b.prototype={initialize:function(){var c,d=this,f="."+d.classes.suggestion,g=d.classes.selected,h=d.options;d.element.setAttribute("autocomplete","off"),d.$wrapper=a('<div class="suggestions-wrapper"/>'),d.el.before(d.$wrapper),d.$wrapper.append(d.el),d.$preloader=a('<i class="suggestions-preloader"/>'),d.$wrapper.append(d.$preloader),d.killerFn=function(b){0===a(b.target).closest("."+d.options.containerClass).length&&(d.killSuggestions(),d.disableKillerFn())},d.suggestionsContainer=b.utils.createNode(h.containerClass),c=a(d.suggestionsContainer),d.$container=c,d.$wrapper.append(c),"auto"!==h.width&&c.width(h.width),c.on("mousedown"+e,f,function(b){b.preventDefault(),d.cancelBlur=!0,d._delay(function(){delete d.cancelBlur}),a(b.target).closest(".ui-menu-item").length||d._delay(function(){a(document).one("mousedown",function(b){b.target===d.element||b.target===d.suggestionsContainer||a.contains(d.suggestionsContainer,b.target)||d.hide()})})}),c.on("mouseover"+e,f,function(){d.activate(a(this).data("index"))}),c.on("mouseout"+e,function(){d.dropdownDisabled||(d.selectedIndex=-1,c.children("."+g).removeClass(g))}),c.on("click"+e,f,function(){d.dropdownDisabled||d.select(a(this).data("index")),d.skipOnFocus=!0,d.el.focus()}),d.fixPosition(),d.fixPositionCapture=function(){d.visible&&d.fixPosition()},d.$viewport.on("resize"+e,d.fixPositionCapture),d.el.on("keydown"+e,function(a){d.onKeyPress(a)}),d.el.on("keyup"+e,function(a){d.onKeyUp(a)}),d.el.on("blur"+e,function(){d.onBlur()}),d.el.on("focus"+e,function(){d.onFocus()}),d.el.on("change"+e,function(a){d.onKeyUp(a)})},onFocus:function(){var a=this;a.skipOnFocus||(a.fixPosition(),a.options.minChars<=a.el.val().length&&a.onValueChange()),a.skipOnFocus=!1},onBlur:function(){var a=this;return a.cancelBlur?void delete a.cancelBlur:(a.selectCurrentValue(),void a.hide())},setOptions:function(b){var c=this,d=c.options;a.extend(d,b),c.isLocal=a.isArray(d.lookup),c.isLocal&&(d.lookup=c.verifySuggestionsFormat(d.lookup));var e={"max-height":d.maxHeight+"px","z-index":d.zIndex};"auto"!==d.width&&(e.width=d.width+"px"),c.$container.css(e),c.checkToken(),c.selectEnrichService()},getAjaxParams:function(){var b,d=this,e=a.trim(d.options.token);return b={type:c.getDefaultType(),dataType:"json",contentType:c.getDefaultContentType()},e&&(b.headers={Authorization:"Token "+e}),b},checkToken:function(){var b,c=this,d=a.trim(c.options.token),e=h[d],f=function(){c.checkToken()};if(d)if(e&&a.isFunction(e.promise))switch(e.state()){case"resolved":c.enable();break;case"rejected":c.disable();break;default:e.always(f)}else b=c.options.serviceUrl,a.isFunction(b)&&(b=b.call(c.element)),h[d]=a.ajax(a.extend(c.getAjaxParams(),{url:b})).always(f)},selectEnrichService:function(){var b=this,c=b.options.dadataType,d=a.trim(b.options.token);b.enrichService=d&&c&&g.types.indexOf(c)>=0?i.dadata:i.default},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){var a=this;a.disabled=!0,a.currentRequest&&a.currentRequest.abort()},enable:function(){this.disabled=!1},fixPosition:function(){var a,b,c=this;a=c.el.offset(),a.bottom=a.top+c.el.outerHeight(),b={top:c.$wrapper.innerHeight()+parseFloat(c.$container.css("border-bottom-width"))+"px",left:-parseFloat(c.$wrapper.css("border-left-width"))+"px"},"auto"===c.options.width?(b.right=-parseFloat(c.$wrapper.css("border-right-width"))+"px",b.width="auto"):(b.rigth="auto",b.width=c.options.width+"px"),c.$container.css(b)},isCursorAtEnd:function(){var a,b=this,c=b.el.val().length,d=b.element.selectionStart;return"number"==typeof d?d===c:document.selection?(a=document.selection.createRange(),a.moveStart("character",-c),c===a.text.length):!0},onKeyPress:function(a){var b,c=this;if(c.triggeredSelectOnSpace=!1,!c.disabled&&!c.visible&&a.which===d.DOWN&&c.currentValue)return void c.suggest();if(!c.disabled&&c.visible){switch(a.which){case d.ESC:c.el.val(c.currentValue),c.hide();break;case d.RIGHT:if(c.hint&&c.options.onHint&&c.isCursorAtEnd()){c.selectHint();break}return;case d.TAB:if(c.hint&&c.options.onHint)return void c.selectHint();if(-1===c.selectedIndex)return void c.hide();if(c.select(c.selectedIndex),c.options.tabDisabled===!1)return;break;case d.RETURN:if(b=c.selectCurrentValue(),-1===b)return void c.hide();break;case d.SPACE:return void(c.options.triggerSelectOnSpace&&(b=c.selectCurrentValue(!0),-1!==b&&(c.triggeredSelectOnSpace=!0)));case d.UP:c.moveUp();break;case d.DOWN:c.moveDown();break;default:return}a.stopImmediatePropagation(),a.preventDefault()}},onKeyUp:function(a){var b=this;if(!b.disabled){switch(a.which){case d.UP:case d.DOWN:return}clearInterval(b.onChangeInterval),b.currentValue!==b.el.val()&&(b.findBestHint(),b.options.deferRequestBy>0?b.onChangeInterval=setInterval(function(){b.onValueChange()},b.options.deferRequestBy):b.onValueChange())}},onValueChange:function(){var b,c=this,d=c.options,e=c.el.val(),f=c.getQuery(e);return c.selection&&(c.selection=null,(d.onInvalidateSelection||a.noop).call(c.element)),clearInterval(c.onChangeInterval),c.currentValue=e,c.selectedIndex=-1,d.triggerSelectOnValidInput&&(b=c.findSuggestionIndex(f),-1!==b)?void c.select(b):void(f.length<d.minChars?c.hide():c.getSuggestions(f))},findSuggestionIndex:function(b){var c=this,d=-1,e=b.toLowerCase();return a.each(c.suggestions,function(a,b){return b.value.toLowerCase()===e?(d=a,!1):void 0}),d},getQuery:function(b){var c,d=this.options.delimiter;return d?(c=b.split(d),a.trim(c[c.length-1])):b},getSuggestionsLocal:function(b){var c,d=this,e=d.options,f=b.toLowerCase(),g=e.lookupFilter,h=parseInt(e.lookupLimit,10);return c={suggestions:a.grep(e.lookup,function(a){return g(a,b,f)})},h&&c.suggestions.length>h&&(c.suggestions=c.suggestions.slice(0,h)),c},getSuggestions:function(b){var d,e,f,g=this,h=g.options,i=h.serviceUrl;if(h.params[h.paramName]=b,e=h.ignoreParams?null:h.params,g.isLocal?d=g.getSuggestionsLocal(b):(a.isFunction(i)&&(i=i.call(g.element,b)),f=i+"?"+a.param(e||{}),d=g.cachedResponse[f]),d&&a.isArray(d.suggestions))g.suggestions=d.suggestions,g.suggest();else if(!g.isBadQuery(b)){if(h.onSearchStart.call(g.element,h.params)===!1)return;g.currentRequest&&g.currentRequest.abort(),g.showPreloader(),g.currentRequest=a.ajax(a.extend(g.getAjaxParams(),{url:i,data:c.serialize(e)})).done(function(a){var c;g.currentRequest=null,c=h.transformResult(a),g.enrichService.enrichResponse.call(g,c,b).done(function(a){g.processResponse(a,b,f),h.onSearchComplete.call(g.element,b,a.suggestions),g.hidePreloader()})}).fail(function(a,c,d){h.onSearchError.call(g.element,b,a,c,d),g.hidePreloader()})}},isBadQuery:function(a){if(!this.options.preventBadQueries)return!1;for(var b=this.badQueries,c=b.length;c--;)if(0===a.indexOf(b[c]))return!0;return!1},hide:function(){var a=this;a.visible=!1,a.selectedIndex=-1,a.$container.hide(),a.signalHint(null)},suggest:function(){if(0===this.suggestions.length)return void this.hide();var b,c=this,d=c.options,e=d.formatResult,f=c.getQuery(c.currentValue),g=c.classes.suggestion,h=c.classes.selected,i=d.beforeRender,j=c.$container,k=[];return d.triggerSelectOnValidInput&&(b=c.findSuggestionIndex(f),-1!==b)?void c.select(b):(d.triggerSelectOnSpace&&!c.triggeredSelectOnSpace&&/\s$/.test(f)&&(b=c.findSuggestionIndex(f.replace(/\s$/,"")),-1!==b&&c.onSelect(b)),d.hint&&c.suggestions.length&&k.push('<div class="'+c.classes.hint+'">'+d.hint+"</div>"),a.each(c.suggestions,function(a,b){k.push('<div class="'+g+'" data-index="'+a+'">'+e(b,f)+"</div>")}),j.html(k.join("")),d.autoSelectFirst&&(c.selectedIndex=0,j.children().first().addClass(h)),a.isFunction(i)&&i.call(c.element,j),j.show(),c.visible=!0,void c.findBestHint())},showPreloader:function(){this.options.usePreloader&&this.$preloader.stop(!0).delay(50).animate({opacity:1},"fast")},hidePreloader:function(){this.options.usePreloader&&this.$preloader.stop(!0).animate({opacity:0},"fast")},findBestHint:function(){var b=this,c=b.el.val().toLowerCase(),d=null;c&&(a.each(b.suggestions,function(a,b){var e=0===b.value.toLowerCase().indexOf(c);return e&&(d=b),!e}),b.signalHint(d))},signalHint:function(b){var c="",d=this;b&&(c=d.currentValue+b.value.substr(d.currentValue.length)),d.hintValue!==c&&(d.hintValue=c,d.hint=b,(this.options.onHint||a.noop)(c))},verifySuggestionsFormat:function(b){return b.length&&"string"==typeof b[0]?a.map(b,function(a){return{value:a,data:null}}):b},processResponse:function(a,b,c){var d=this,e=d.options;a.suggestions=d.verifySuggestionsFormat(a.suggestions),e.noCache||(d.cachedResponse[c]=a,e.preventBadQueries&&0===a.suggestions.length&&d.badQueries.push(b)),b===d.getQuery(d.currentValue)&&(d.suggestions=a.suggestions,d.suggest())},activate:function(b){var c,d,e=this,f=e.classes.selected;return!e.dropdownDisabled&&(d=e.$container.children("."+e.classes.suggestion),d.filter("."+f).removeClass(f),e.selectedIndex=b,-1!==e.selectedIndex&&d.length>e.selectedIndex)?(c=d.get(e.selectedIndex),a(c).addClass(f),c):null},enableDropdown:function(){var a=this;a.dropdownDisabled=!1,a.$container.attr("disabled",!1)},disableDropdown:function(){var a=this;a.dropdownDisabled=!0,a.$container.attr("disabled",!0)},selectHint:function(){var b=this,c=a.inArray(b.hint,b.suggestions);b.select(c)},selectCurrentValue:function(a){var b=this,c=b.selectedIndex;if(-1===c){var d=b.getQuery(b.el.val());c=b.findSuggestionIndex(d)}return-1!==c&&b.select(c,a),c},select:function(a,b){var c=this,d=c.suggestions[a];c.currentValue=c.getValue(d.value),c.el.val(c.currentValue),c.signalHint(null),c.selection=d,c.onSelect(a).done(function(){b||c.hide()}),c.suggestions=[]},unselect:function(){var a=this;a.$container.children().removeClass(a.classes.selected),a.selectedIndex=-1,a.el.val(a.currentValue),a.findBestHint()},moveUp:function(){var a=this;if(!a.dropdownDisabled)return-1===a.selectedIndex?void(a.suggestions.length&&a.adjustScroll(a.suggestions.length-1)):0===a.selectedIndex?void a.unselect():void a.adjustScroll(a.selectedIndex-1)},moveDown:function(){var a=this;if(!a.dropdownDisabled)return a.selectedIndex===a.suggestions.length-1?void a.unselect():void a.adjustScroll(a.selectedIndex+1)},adjustScroll:function(a){var b,c,d,e=this,f=e.activate(a),g=25;f&&(b=f.offsetTop,c=e.$container.scrollTop(),d=c+e.options.maxHeight-g,c>b?e.$container.scrollTop(b):b>d&&e.$container.scrollTop(b-e.options.maxHeight+g),e.el.val(e.getValue(e.suggestions[a].value)),e.signalHint(null))},onSelect:function(b){var c=this,d=c.options.onSelect,e=c.suggestions[b],f=a.Deferred();return a.isFunction(d)?c.enrichService.enrichSuggestion.call(c,e).done(function(a){d.call(c.element,a),f.resolve()}):f.resolve(),f},getValue:function(a){var b,c,d=this,e=d.options.delimiter;return e?(b=d.currentValue,c=b.split(e),1===c.length?a:b.substr(0,b.length-c[c.length-1].length)+a):a},dispose:function(){var a=this;a.el.off(e).removeData(f),a.$viewport.off("resize"+e),a.$container.remove(),a.$preloader.remove(),a.el.unwrap()},_delay:function(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)}},a.fn.suggestions=function(c,d){return 0===arguments.length?this.first().data(f):this.each(function(){var e=a(this),g=e.data(f);"string"==typeof c?g&&"function"==typeof g[c]&&g[c](d):(g&&g.dispose&&g.dispose(),g=new b(this,c),e.data(f,g))})}});