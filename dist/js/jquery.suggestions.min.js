/**
 * DaData.ru Suggestions jQuery plugin, version 4.4.2
 *
 * DaData.ru Suggestions jQuery plugin is freely distributable under the terms of MIT-style license
 * Built on DevBridge Autocomplete for jQuery (https://github.com/devbridge/jQuery-Autocomplete)
 * For details, see https://github.com/hflabs/suggestions-jquery
 */
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";function b(c,d){var e=this,f={autoSelectFirst:!1,serviceUrl:null,onSelect:null,onInvalidateSelection:a.noop,onSearchStart:a.noop,onSearchComplete:a.noop,onSearchError:a.noop,minChars:1,width:"auto",zIndex:9999,maxHeight:300,deferRequestBy:0,params:{},paramName:"query",ignoreParams:!1,formatResult:b.formatResult,delimiter:null,noCache:!1,containerClass:"suggestions-suggestions",tabDisabled:!1,triggerSelectOnSpace:!0,preventBadQueries:!1,usePreloader:!0,hint:b.defaultHint,useDadata:!0,type:null,count:b.defaultCount,constraints:null};e.element=c,e.el=a(c),e.suggestions=[],e.badQueries=[],e.selectedIndex=-1,e.currentValue=e.element.value,e.intervalId=0,e.cachedResponse={},e.currentRequest=null,e.onChangeTimeout=null,e.$wrapper=null,e.options=a.extend({},f,d),e.classes={hint:"suggestions-hint",selected:"suggestions-selected",suggestion:"suggestions-suggestion",removeConstraint:"suggestions-remove"},e.selection=null,e.$viewport=a(window),e.initialize(),e.setOptions(d)}var c=function(){var b=0;return{escapeRegExChars:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},getDefaultType:function(){return a.support.cors?"POST":"GET"},getDefaultContentType:function(){return a.support.cors?"application/json":"application/x-www-form-urlencoded"},serialize:function(b){return a.support.cors?JSON.stringify(b):a.param(b,!0)},compact:function(b){return a.grep(b,function(a){return!!a})},delay:function(a,b){return setTimeout(a,b||0)},uniqueId:function(a){return(a||"")+ ++b},slice:function(a,b){return Array.prototype.slice.call(a,b)}}}(),d={ESC:27,TAB:9,RETURN:13,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40},e=["NAME","ADDRESS"],f=[],g=[],h=[],i=[],j=[],k=[],l=".suggestions",m="suggestions";b.utils=c,b.formatResult=function(a,b){var d="(^|\\s+)("+c.escapeRegExChars(b)+")";return a.value.replace(new RegExp(d,"gi"),"$1<strong>$2</strong>")},b.defaultHint="Выберите вариант ниже или продолжите ввод",b.defaultCount=10,a.Suggestions=b,b.prototype={initialize:function(){var a=this;a.element.setAttribute("autocomplete","off"),a.uniqueId=c.uniqueId("i"),a.createWrapper(),a.applyHooks(f),a.bindWindowEvents(),a.fixPosition()},dispose:function(){var a=this;a.applyHooks(g),a.el.removeData(m),a.unbindWindowEvents(),a.removeWrapper()},applyHooks:function(b){var d=this,e=c.slice(arguments,1);return a.map(b,function(a){return a.apply(d,e)})},createWrapper:function(){var b=this;b.$wrapper=a('<div class="suggestions-wrapper"/>'),b.el.after(b.$wrapper)},removeWrapper:function(){this.$wrapper.remove()},bindWindowEvents:function(){var b=this;b.$viewport.on("resize"+l+b.uniqueId,a.proxy(b.fixPosition,b))},unbindWindowEvents:function(){this.$viewport.off("resize"+l+this.uniqueId)},setOptions:function(b){var c=this;a.extend(c.options,b),c.applyHooks(h)},fixPosition:function(){var a,b,c,d=this,e={};d.el.css("paddingLeft",""),e.paddingLeft=parseFloat(d.el.css("paddingLeft")),e.paddingRight=parseFloat(d.el.css("paddingRight")),a=d.el.offset(),e.borderTop="none"==d.el.css("border-top-style")?0:parseFloat(d.el.css("border-top-width")),e.borderLeft="none"==d.el.css("border-left-style")?0:parseFloat(d.el.css("border-left-width")),e.innerHeight=d.el.innerHeight(),e.innerWidth=d.el.innerWidth(),b=d.$wrapper.offset(),c={top:a.top-b.top,left:a.left-b.left},d.applyHooks(i,c,e),d.el.css("paddingLeft",e.paddingLeft+"px")},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.selection=null,this.suggestions=[]},disable:function(){var a=this;a.disabled=!0,a.currentRequest&&a.currentRequest.abort(),a.hide()},enable:function(){this.disabled=!1},getAjaxParams:function(){var b,d=this,e=a.trim(d.options.token);return b={type:c.getDefaultType(),dataType:"json",contentType:c.getDefaultContentType()},e&&(b.headers={Authorization:"Token "+e}),b},getQuery:function(b){var c,d=this.options.delimiter;return d?(c=b.split(d),a.trim(c[c.length-1])):b},constructRequestParams:function(b){var c=this,d=c.options,e=null;return d.ignoreParams||(e=a.extend({},d.params),a.each(c.applyHooks(j),function(b,c){a.extend(e,c)}),e[d.paramName]=b,a.isNumeric(d.count)&&d.count>0&&(e.count=d.count)),e},getSuggestions:function(b){var d,e,f=this,g=f.options,h=g.serviceUrl,i=f.constructRequestParams(b);if(a.isFunction(h)&&(h=h.call(f.element,b)),e=h+"?"+a.param(i||{}),d=f.cachedResponse[e],d&&a.isArray(d.suggestions))f.assignSuggestions(d.suggestions,b);else if(!f.isBadQuery(b)){if(g.onSearchStart.call(f.element,i)===!1)return;f.currentRequest&&f.currentRequest.abort(),f.showPreloader(),f.currentRequest=a.ajax(a.extend(f.getAjaxParams(),{url:h,data:c.serialize(i)})).always(function(){f.currentRequest=null}).done(function(a){f.enrichService.enrichResponse.call(f,a,b).done(function(a){f.processResponse(a,b,e),g.onSearchComplete.call(f.element,b,a.suggestions),f.hidePreloader()})}).fail(function(a,c,d){g.onSearchError.call(f.element,b,a,c,d),f.hidePreloader()})}},isBadQuery:function(b){if(!this.options.preventBadQueries)return!1;var c=!1;return a.each(this.badQueries,function(a,d){return!(c=0===b.indexOf(d))}),c},verifySuggestionsFormat:function(b){return b.length&&"string"==typeof b[0]?a.map(b,function(a){return{value:a,data:null}}):b},processResponse:function(b,c,d){var e=this,f=e.options;b&&a.isArray(b.suggestions)&&(b.suggestions=e.verifySuggestionsFormat(b.suggestions),f.noCache||(e.cachedResponse[d]=b,f.preventBadQueries&&0===b.suggestions.length&&e.badQueries.push(c)),c===e.getQuery(e.currentValue)&&e.assignSuggestions(b.suggestions,c))},assignSuggestions:function(a,b){var c=this;c.suggestions=a,c.applyHooks(k,b)},getValue:function(a){var b,c,d=this,e=d.options.delimiter;return e?(b=d.currentValue,c=b.split(e),1===c.length?a:b.substr(0,b.length-c[c.length-1].length)+a):a},findSuggestionIndex:function(b){var c=this,d=-1,e=b.toLowerCase();return a.each(c.suggestions,function(a,b){return b.value.toLowerCase()===e?(d=a,!1):void 0}),d}},function(){var e={bindElementEvents:function(){var b=this;b.el.on("keydown"+l,a.proxy(b.onElementKeyDown,b)),b.el.on("keyup"+l,a.proxy(b.onElementKeyUp,b)),b.el.on("blur"+l,a.proxy(b.onElementBlur,b)),b.el.on("focus"+l,a.proxy(b.onElementFocus,b)),b.el.on("change"+l,a.proxy(b.onElementKeyUp,b))},unbindElementEvents:function(){this.el.off(l)},onElementBlur:function(){var a=this;return a.cancelBlur?void delete a.cancelBlur:void a.selectCurrentValue({noSpace:!0})},onElementFocus:function(){var a=this;a.cancelFocus||(a.fixPosition(),a.options.minChars<=a.el.val().length&&a.onValueChange()),a.cancelFocus=!1},onElementKeyDown:function(a){var b,c=this;if(c._lastPressedKeyCode=a.which,!c.disabled&&!c.visible&&a.which===d.DOWN&&c.currentValue)return void c.suggest();if(!c.disabled&&c.visible){switch(a.which){case d.ESC:c.el.val(c.currentValue),c.hide();break;case d.RIGHT:return;case d.TAB:if(-1===c.selectedIndex)return void c.hide();if(c.select(c.selectedIndex,{noSpace:!0}),c.options.tabDisabled===!1)return;break;case d.RETURN:c.selectCurrentValue();break;case d.SPACE:return void(c.options.triggerSelectOnSpace&&c.isCursorAtEnd()&&(b=c.selectCurrentValue({noHide:!0,noSpace:!0}),c._waitingForTriggerSelectOnSpace=-1!==b));case d.UP:c.moveUp();break;case d.DOWN:c.moveDown();break;default:return}a.stopImmediatePropagation(),a.preventDefault()}},onElementKeyUp:function(a){var b=this;if(!b.disabled){switch(a.which){case d.UP:case d.DOWN:return}clearTimeout(b.onChangeTimeout),b.currentValue!==b.el.val()&&(b.options.deferRequestBy>0?b.onChangeTimeout=c.delay(function(){b.onValueChange()},b.options.deferRequestBy):b.onValueChange())}},onValueChange:function(){var b=this,c=b.options,d=b.el.val(),e=b.getQuery(d);b.selection&&((c.onInvalidateSelection||a.noop).call(b.element,b.selection),b.selection=null),clearTimeout(b.onChangeTimeout),b.currentValue=d,b.selectedIndex=-1,e.length<c.minChars?b.hide():b.getSuggestions(e)},isCursorAtEnd:function(){var a,b=this,c=b.el.val().length,d=b.element.selectionStart;return"number"==typeof d?d===c:document.selection?(a=document.selection.createRange(),a.moveStart("character",-c),c===a.text.length):!0}};a.extend(b.prototype,e),f.push(e.bindElementEvents),g.push(e.unbindElementEvents)}(),function(){var c={},d={checkToken:function(){var b,d=this,e=a.trim(d.options.token),f=c[e],g=function(){d.checkToken()};if(e)if(f&&a.isFunction(f.promise))switch(f.state()){case"resolved":d.enable();break;case"rejected":d.disable();break;default:f.always(g)}else b=d.options.serviceUrl,a.isFunction(b)&&(b=b.call(d.element)),c[e]=a.ajax(a.extend(d.getAjaxParams(),{url:b})).always(g)}};b.resetTokens=function(){c={}},a.extend(b.prototype,d),h.push(d.checkToken)}(),function(){var d={url:"https://dadata.ru/api/v1/clean",timeout:1e3},f={"default":{enrichSuggestion:function(b){return a.Deferred().resolve(b)},enrichResponse:function(b){return a.Deferred().resolve(b)}},dadata:function(){function b(b){var c=this,e=a.trim(c.options.token),f={structure:[c.options.type],data:[[b]]};return c.currentRequest=a.ajax(d.url,{type:"POST",headers:{Authorization:"Token "+e},contentType:"application/json",dataType:"json",data:JSON.stringify(f),timeout:d.timeout}),c.currentRequest}function e(a,b){return!(a in b)||"house"===a}var f={};f.gender=function(a){return{gender:"М"==a?"MALE":"Ж"==a?"FEMALE":"UNKNOWN"}},a.each(["region","area","city","settlement","street"],function(a,b){function c(a){if("city"===b||"settlement"===b||"street"===b)return!0;var c=/^(г|Респ|тер|у)/i;return c.test(a)}f[b]=function(a){var d,e,f={};if(a){var g=a.split(" ");d=c(a)?g.shift():g.pop(),e=g.join(" ")}else d=null,e=a;return f[b+"_type"]=d,f[b]=e,f}});var g={NAME:function(a){return c.compact([a.surname,a.name,a.patronymic]).join(" ")},ADDRESS:function(a){return c.compact([a.country,a.region,a.area,a.city,a.settlement,a.street,c.compact([a.house_type,a.house]).join(" "),c.compact([a.block_type,a.block]).join(" "),c.compact([a.flat_type,a.flat]).join(" ")]).join(", ")}};return{enrichSuggestion:function(c){var d=this,g=a.Deferred();return c.data&&"qc"in c.data?g.resolve(c):(d.showPreloader(),d.disableDropdown(),b.call(d,c.value).always(function(){d.hidePreloader(),d.enableDropdown(),d.currentRequest=null}).done(function(b){var d=b.data,h=d&&d[0]&&d[0][0];h&&0===h.qc&&(c.data||(c.data={}),delete h.source,a.each(h,function(b,d){if(e(b,c.data)){var g=f[b];g?a.extend(c.data,g(d)):c.data[b]=d}})),g.resolve(c)}).fail(function(){g.resolve(c)}),g)},enrichResponse:function(c,d){var e=this,h=c.suggestions||[],i=a.Deferred();return h.length?i.resolve(c):(b.call(e,d).always(function(){e.currentRequest=null}).done(function(b){var d,h=b.data;h=h&&h[0]&&h[0][0],h&&(delete h.source,d=g[e.options.type](h),d&&(a.each(f,function(b,c){b in h&&a.extend(h,c(h[b]))}),c.suggestions=[{value:d,data:h}])),i.resolve(c)}).fail(function(){i.resolve(c)}),i)}}}()},g={selectEnrichService:function(){var b=this,c=b.options.type,d=a.trim(b.options.token);b.enrichService=b.options.useDadata&&c&&e.indexOf(c)>=0&&d?f.dadata:f.default}};b.dadataConfig=d,h.push(g.selectEnrichService)}(),function(){var d={createContainer:function(){var b=this,c="."+b.classes.suggestion,d=b.options,e=a("<div/>").addClass(d.containerClass).css({position:"absolute",display:"none"});b.$container=e,b.$wrapper.append(e),"auto"!==d.width&&e.width(d.width),e.on("mousedown"+l,c,a.proxy(b.onSuggestionMousedown,b)),e.on("mouseover"+l,c,a.proxy(b.onSuggestionMouseover,b)),e.on("click"+l,c,a.proxy(b.onSuggestionClick,b)),e.on("mouseout"+l,a.proxy(b.onSuggestionsMouseout,b))},applyContainerOptions:function(){var a=this,b=a.options;a.$container.css({"max-height":b.maxHeight+"px","z-index":b.zIndex,width:b.width})},onSuggestionMousedown:function(b){var d=this;b.preventDefault(),d.cancelBlur=!0,c.delay(function(){delete d.cancelBlur}),a(b.target).closest(".ui-menu-item").length||c.delay(function(){a(document).one("mousedown",function(b){b.target===d.element||a.contains(d.$wrapper[0],b.target)||d.hide()})})},onSuggestionMouseover:function(a){this.activate(this.getClosestSuggestionIndex(a.target))},onSuggestionClick:function(a){var b=this;b.dropdownDisabled||b.select(b.getClosestSuggestionIndex(a.target)),b.cancelFocus=!0,b.el.focus()},onSuggestionsMouseout:function(){this.deactivate(!1)},setDropdownPosition:function(a,b){var c=this;c.$container.css({left:a.left+"px",top:a.top+b.borderTop+b.innerHeight+"px",width:("auto"===c.options.width?c.el.outerWidth():c.options.width)+"px"})},getClosestSuggestionIndex:function(b){var c=this,d=a(b),e="."+c.classes.suggestion+"[data-index]";return d.is(e)||(d=d.closest(e)),d.data("index")},getSuggestionsItems:function(){return this.$container.children("."+this.classes.suggestion)},toggleDropdownEnabling:function(a){this.dropdownDisabled=!a,this.$container.attr("disabled",!a)},disableDropdown:function(){this.toggleDropdownEnabling(!1)},enableDropdown:function(){this.toggleDropdownEnabling(!0)},hasSuggestionsToChoose:function(){var b=this;return b.suggestions.length>1||1===b.suggestions.length&&(!b.selection||a.trim(b.suggestions[0].value)!=a.trim(b.selection.value))},suggest:function(){if(!this.hasSuggestionsToChoose())return void this.hide();var b=this,c=b.options,d=c.formatResult,e=a.trim(b.getQuery(b.currentValue)),f=c.beforeRender,g=[];c.hint&&b.suggestions.length&&g.push('<div class="'+b.classes.hint+'">'+c.hint+"</div>"),a.each(b.suggestions,function(a,c){g.push('<div class="'+b.classes.suggestion+'" data-index="'+a+'">'+d(c,e)+"</div>")}),b.$container.html(g.join("")),c.autoSelectFirst&&(b.selectedIndex=0,b.getSuggestionsItems().first().addClass(b.classes.selected)),a.isFunction(f)&&f.call(b.element,b.$container),b.$container.show(),b.visible=!0},hide:function(){var a=this;a.visible=!1,a.selectedIndex=-1,a.$container.hide().empty()},activate:function(b){var c,d,e=this,f=e.classes.selected;return!e.dropdownDisabled&&(d=e.getSuggestionsItems(),d.removeClass(f),e.selectedIndex=b,-1!==e.selectedIndex&&d.length>e.selectedIndex)?(c=d.get(e.selectedIndex),a(c).addClass(f),c):null},deactivate:function(a){var b=this;b.dropdownDisabled||(b.selectedIndex=-1,b.getSuggestionsItems().removeClass(b.classes.selected),a&&b.el.val(b.currentValue))},moveUp:function(){var a=this;if(!a.dropdownDisabled)return-1===a.selectedIndex?void(a.suggestions.length&&a.adjustScroll(a.suggestions.length-1)):0===a.selectedIndex?void a.deactivate(!0):void a.adjustScroll(a.selectedIndex-1)},moveDown:function(){var a=this;if(!a.dropdownDisabled)return a.selectedIndex===a.suggestions.length-1?void a.deactivate(!0):void a.adjustScroll(a.selectedIndex+1)},adjustScroll:function(a){var b,c,d,e=this,f=e.activate(a),g=25;f&&(b=f.offsetTop,c=e.$container.scrollTop(),d=c+e.options.maxHeight-g,c>b?e.$container.scrollTop(b):b>d&&e.$container.scrollTop(b-e.options.maxHeight+g),e.el.val(e.getValue(e.suggestions[a].value)))}};a.extend(b.prototype,d),f.push(d.createContainer),h.push(d.applyContainerOptions),i.push(d.setDropdownPosition),k.push(d.suggest)}(),function(){var c={createPreloader:function(){var b=this;b.$preloader=a('<i class="suggestions-preloader"/>'),b.$wrapper.append(b.$preloader)},setPreloaderPosition:function(a,b){var c=this;c.$preloader.css({left:a.left+b.borderLeft+b.innerWidth-c.$preloader.width()-b.paddingRight+"px",top:a.top+b.borderTop+Math.round((b.innerHeight-c.$preloader.height())/2)+"px"})},showPreloader:function(){this.options.usePreloader&&this.$preloader.stop(!0).delay(50).animate({opacity:1},"fast")},hidePreloader:function(){this.options.usePreloader&&this.$preloader.stop(!0).animate({opacity:0},"fast")}};a.extend(b.prototype,c),f.push(c.createPreloader),i.push(c.setPreloaderPosition)}(),function(){var d={createConstraints:function(){var b=this;b.constraints={},b.$constraints=a('<ul class="suggestions-constraints"/>'),b.$wrapper.append(b.$constraints),b.$constraints.on("click","."+b.classes.removeConstraint,a.proxy(b.onConstraintRemoveClick,b))},setConstraintsPosition:function(a,b){var c=this;c.$constraints.css({left:a.left+b.borderLeft+b.paddingLeft+"px",top:a.top+b.borderTop+Math.round((b.innerHeight-c.$constraints.height())/2)+"px"}),b.paddingLeft+=c.$constraints.outerWidth(!0)},onConstraintRemoveClick:function(b){var c=this,d=a(b.target).closest("li"),e=d.attr("data-constraint-id");d.fadeOut("fast",function(){c.removeConstraint(e)})},setupConstraints:function(){var b=this,c=b.options.constraints;c&&(b._constraintsUpdating=!0,a.each(b.constraints,a.proxy(b.removeConstraint,b)),a.each(a.makeArray(c),function(a,c){b.addConstraint(c)}),b._constraintsUpdating=!1,b.fixPosition())},formatConstraint:function(b){if(b&&b.restrictions){if(b.restrictions=a.makeArray(b.restrictions),!b.label){var c=[];a.each(b.restrictions,function(b,d){a.each(["kladr_id","okato","postal_code","region","area","city","settlement"],function(a,b){d[b]&&c.push(d[b])})}),b.label=c.join(", ")}return b}},addConstraint:function(b){var d,e,f=this;b=f.formatConstraint(b),b&&(e=c.uniqueId("c"),f.constraints[e]=b,d=a("<li/>").append(a("<span/>").text(b.label)).attr("data-constraint-id",e),b.deletable&&d.append(a('<span class="suggestions-remove"/>')),f.$constraints.append(d),f._constraintsUpdating||f.fixPosition())},removeConstraint:function(a){var b=this;delete b.constraints[a],b.$constraints.children('[data-constraint-id="'+a+'"]').remove(),b._constraintsUpdating||b.fixPosition()},constructConstraintsParams:function(){var b=this,c=[],d={};return a.each(b.constraints,function(a,b){c=c.concat(b.restrictions)}),c.length&&(d.restrictions=c),d}};a.extend(b.prototype,d),f.push(d.createConstraints),h.push(d.setupConstraints),i.push(d.setConstraintsPosition),j.push(d.constructConstraintsParams)}(),function(){var c={selectExpectedComponents:function(){var b=this,c=b.options.type,d=b.options.params;switch(c){case"NAME":b.expectedComponents=a.map(d&&d.parts||["surname","name","patronymic"],function(a){return a.toLowerCase()});break;case"ADDRESS":b.expectedComponents=["house"];break;default:b.expectedComponents=[]}},hasAllExpectedComponents:function(b){var c=!0;return a.each(this.expectedComponents,function(a,d){return c=!!b.data[d]}),c},selectCurrentValue:function(a){var b=this,c=b.selectedIndex,d=a&&a.noHide;if(-1===c){var e=b.getQuery(b.el.val());c=b.findSuggestionIndex(e)}-1!==c?b.select(c,a):d||b.hide()},select:function(b,c){function d(){i?(f.selectedIndex=-1,f.getSuggestions(f.currentValue)):(f.hide(),f.suggestions=[])}var e,f=this,g=f.suggestions[b],h=f.options.onSelect,i=c&&c.noHide,j=c&&c.noSpace;g&&(e=f.hasAllExpectedComponents(g),f.options.type&&e&&(i=!1),f.currentValue=f.getValue(g.value),j||e||(f.currentValue+=" "),f.el.val(f.currentValue),f.selection=g,a.isFunction(h)?f.enrichService.enrichSuggestion.call(f,g).done(function(a){h.call(f.element,a),d()}):d())},trySelectOnSpace:function(a){var b,c=this,e=/\s$/;c.options.triggerSelectOnSpace&&c._waitingForTriggerSelectOnSpace&&c._lastPressedKeyCode==d.SPACE&&e.test(a)&&(b=c.findSuggestionIndex(a.replace(e,"")),-1!==b&&(c._waitingForTriggerSelectOnSpace=!1,c.select(b,{noHide:!0})))}};a.extend(b.prototype,c),h.push(c.selectExpectedComponents),k.push(c.trySelectOnSpace)}(),a.fn.suggestions=function(c,d){return 0===arguments.length?this.first().data(m):this.each(function(){var e=a(this),f=e.data(m);"string"==typeof c?f&&"function"==typeof f[c]&&f[c](d):(f&&f.dispose&&f.dispose(),f=new b(this,c),e.data(m,f))})}});