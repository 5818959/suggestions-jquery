/**
 * DaData.ru Suggestions jQuery plugin, version 4.4.2
 *
 * DaData.ru Suggestions jQuery plugin is freely distributable under the terms of MIT-style license
 * Built on DevBridge Autocomplete for jQuery (https://github.com/devbridge/jQuery-Autocomplete)
 * For details, see https://github.com/hflabs/suggestions-jquery
 */
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";function b(d,e){var f=this,g={autoSelectFirst:!1,serviceUrl:null,onSelect:null,onInvalidateSelection:a.noop,onSearchStart:a.noop,onSearchComplete:a.noop,onSearchError:a.noop,minChars:1,width:"auto",zIndex:9999,maxHeight:300,deferRequestBy:0,params:{},paramName:"query",ignoreParams:!1,formatResult:b.formatResult,delimiter:null,noCache:!1,containerClass:"suggestions-suggestions",tabDisabled:!1,triggerSelectOnSpace:!0,preventBadQueries:!1,usePreloader:!0,hint:b.defaultHint,useDadata:!0,type:null,count:b.defaultCount,constraints:null};f.element=d,f.el=a(d),f.suggestions=[],f.badQueries=[],f.selectedIndex=-1,f.currentValue=f.element.value,f.intervalId=0,f.cachedResponse={},f.currentRequest=null,f.onChangeTimeout=null,f.$wrapper=null,f.$preloader=null,f.$constraints=null,f.options=a.extend({},g,e),f.classes={hint:"suggestions-hint",selected:"suggestions-selected",suggestion:"suggestions-suggestion",removeConstraint:"suggestions-remove"},f.selection=null,f.$viewport=a(window),f.cancelBlur=!1,f.cancelFocus=!1,f.enrichService=j.default,f.dropdownDisabled=!1,f.expectedComponents=[],f.constraints={},f.uniqueId=c.uniqueId("i"),f._waitingForTriggerSelectOnSpace=!1,f._constraintsUpdating=!1,f._lastPressedKeyCode=0,f.initialize(),f.setOptions(e)}var c=function(){var b=0;return{escapeRegExChars:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},getDefaultType:function(){return a.support.cors?"POST":"GET"},getDefaultContentType:function(){return a.support.cors?"application/json":"application/x-www-form-urlencoded"},serialize:function(b){return a.support.cors?JSON.stringify(b):a.param(b,!0)},compact:function(b){return a.grep(b,function(a){return!!a})},delay:function(a,b){return setTimeout(a,b||0)},uniqueId:function(a){return(a||"")+ ++b}}}(),d={ESC:27,TAB:9,RETURN:13,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40},e=["NAME","ADDRESS"],f=".suggestions",g="suggestions",h={url:"https://dadata.ru/api/v1/clean",timeout:1e3},i={},j={"default":{enrichSuggestion:function(b){return a.Deferred().resolve(b)},enrichResponse:function(b){return a.Deferred().resolve(b)}},dadata:function(){function b(b){var c=this,d=a.trim(c.options.token),e={structure:[c.options.type],data:[[b]]};return c.currentRequest=a.ajax(h.url,{type:"POST",headers:{Authorization:"Token "+d},contentType:"application/json",dataType:"json",data:JSON.stringify(e),timeout:h.timeout}),c.currentRequest}var d={};d.gender=function(a){return{gender:"М"==a?"MALE":"Ж"==a?"FEMALE":"UNKNOWN"}},a.each(["region","area","city","settlement","street"],function(a,b){function c(a){if("city"===b||"settlement"===b||"street"===b)return!0;var c=/^(г|Респ|тер|у)/i;return c.test(a)}d[b]=function(a){var d,e,f={};if(a){var g=a.split(" ");d=c(a)?g.shift():g.pop(),e=g.join(" ")}else d=null,e=a;return f[b+"_type"]=d,f[b]=e,f}});var e={NAME:function(a){return c.compact([a.surname,a.name,a.patronymic]).join(" ")},ADDRESS:function(a){return c.compact([a.country,a.region,a.area,a.city,a.settlement,a.street,c.compact([a.house_type,a.house]).join(" "),c.compact([a.block_type,a.block]).join(" "),c.compact([a.flat_type,a.flat]).join(" ")]).join(", ")}};return{enrichSuggestion:function(c){var e=this,f=a.Deferred();return c.data&&"qc"in c.data?f.resolve(c):(e.showPreloader(),e.disableDropdown(),b.call(e,c.value).always(function(){e.hidePreloader(),e.enableDropdown(),e.currentRequest=null}).done(function(b){var e=b.data,g=e&&e[0]&&e[0][0];g&&0===g.qc&&(c.data||(c.data={}),delete g.source,a.each(g,function(b,e){if(!(b in c.data)){var f=d[b];f?a.extend(c.data,f(e)):c.data[b]=e}})),f.resolve(c)}).fail(function(){f.resolve(c)}),f)},enrichResponse:function(c,f){var g=this,h=c.suggestions||[],i=a.Deferred();return h.length?i.resolve(c):(b.call(g,f).always(function(){g.currentRequest=null}).done(function(b){var f,h=b.data;h=h&&h[0]&&h[0][0],h&&(delete h.source,f=e[g.options.type](h),f&&(a.each(d,function(b,c){b in h&&a.extend(h,c(h[b]))}),c.suggestions=[{value:f,data:h}])),i.resolve(c)}).fail(function(){i.resolve(c)}),i)}}}()};b.utils=c,b.formatResult=function(a,b){var d="(^|\\s+)("+c.escapeRegExChars(b)+")";return a.value.replace(new RegExp(d,"gi"),"$1<strong>$2</strong>")},b.resetTokens=function(){i={}},b.defaultHint="Выберите вариант ниже или продолжите ввод",b.dadataConfig=h,b.defaultCount=10,a.Suggestions=b,b.prototype={initialize:function(){var a=this;a.element.setAttribute("autocomplete","off"),a.createWrapper(),a.createPreloader(),a.createConstraints(),a.createContainer(),a.bindElementEvents(),a.bindWindowEvents(),a.fixPosition()},dispose:function(){var a=this;a.unbindElementEvents(),a.el.removeData(g),a.unbindWindowEvents(),a.removeWrapper()},createWrapper:function(){var b=this;b.$wrapper=a('<div class="suggestions-wrapper"/>'),b.el.after(b.$wrapper)},createPreloader:function(){var b=this;b.$preloader=a('<i class="suggestions-preloader"/>'),b.$wrapper.append(b.$preloader)},createConstraints:function(){var b=this;b.$constraints=a('<ul class="suggestions-constraints"/>'),b.$wrapper.append(b.$constraints),b.$constraints.on("click","."+b.classes.removeConstraint,a.proxy(b.onConstraintRemoveClick,b))},createContainer:function(){var b=this,c="."+b.classes.suggestion,d=b.options,e=a("<div/>").addClass(d.containerClass).css({position:"absolute",display:"none"});b.$container=e,b.$wrapper.append(e),"auto"!==d.width&&e.width(d.width),e.on("mousedown"+f,c,a.proxy(b.onSuggestionMousedown,b)),e.on("mouseover"+f,c,a.proxy(b.onSuggestionMouseover,b)),e.on("click"+f,c,a.proxy(b.onSuggestionClick,b)),e.on("mouseout"+f,a.proxy(b.onSuggestionsMouseout,b))},bindElementEvents:function(){var b=this;b.el.on("keydown"+f,a.proxy(b.onElementKeyDown,b)),b.el.on("keyup"+f,a.proxy(b.onElementKeyUp,b)),b.el.on("blur"+f,a.proxy(b.onElementBlur,b)),b.el.on("focus"+f,a.proxy(b.onElementFocus,b)),b.el.on("change"+f,a.proxy(b.onElementKeyUp,b))},unbindElementEvents:function(){this.el.off(f)},bindWindowEvents:function(){var b=this;b.$viewport.on("resize"+f+b.uniqueId,a.proxy(b.fixPosition,b))},unbindWindowEvents:function(){this.$viewport.off("resize"+f+this.uniqueId)},removeWrapper:function(){this.$wrapper.remove()},onElementBlur:function(){var a=this;return a.cancelBlur?void delete a.cancelBlur:void a.selectCurrentValue({noSpace:!0})},onElementFocus:function(){var a=this;a.cancelFocus||(a.fixPosition(),a.options.minChars<=a.el.val().length&&a.onValueChange()),a.cancelFocus=!1},onElementKeyDown:function(a){var b,c=this;if(c._lastPressedKeyCode=a.which,!c.disabled&&!c.visible&&a.which===d.DOWN&&c.currentValue)return void c.suggest();if(!c.disabled&&c.visible){switch(a.which){case d.ESC:c.el.val(c.currentValue),c.hide();break;case d.RIGHT:return;case d.TAB:if(-1===c.selectedIndex)return void c.hide();if(c.select(c.selectedIndex,{noSpace:!0}),c.options.tabDisabled===!1)return;break;case d.RETURN:c.selectCurrentValue({noHide:!0});break;case d.SPACE:return void(c.options.triggerSelectOnSpace&&c.isCursorAtEnd()&&(b=c.selectCurrentValue({noHide:!0,noSpace:!0}),c._waitingForTriggerSelectOnSpace=-1!==b));case d.UP:c.moveUp();break;case d.DOWN:c.moveDown();break;default:return}a.stopImmediatePropagation(),a.preventDefault()}},onElementKeyUp:function(a){var b=this;if(!b.disabled){switch(a.which){case d.UP:case d.DOWN:return}clearTimeout(b.onChangeTimeout),b.currentValue!==b.el.val()&&(b.options.deferRequestBy>0?b.onChangeTimeout=c.delay(function(){b.onValueChange()},b.options.deferRequestBy):b.onValueChange())}},onValueChange:function(){var b=this,c=b.options,d=b.el.val(),e=b.getQuery(d);b.selection&&((c.onInvalidateSelection||a.noop).call(b.element,b.selection),b.selection=null),clearTimeout(b.onChangeTimeout),b.currentValue=d,b.selectedIndex=-1,e.length<c.minChars?b.hide():b.getSuggestions(e)},onSuggestionMousedown:function(b){var d=this;b.preventDefault(),d.cancelBlur=!0,c.delay(function(){delete d.cancelBlur}),a(b.target).closest(".ui-menu-item").length||c.delay(function(){a(document).one("mousedown",function(b){b.target===d.element||a.contains(d.$wrapper[0],b.target)||d.hide()})})},onSuggestionMouseover:function(a){this.activate(this.getClosestSuggestionIndex(a.target))},onSuggestionClick:function(a){var b=this;b.dropdownDisabled||b.select(b.getClosestSuggestionIndex(a.target),{noHide:!0}),b.cancelFocus=!0,b.el.focus()},onSuggestionsMouseout:function(){this.deactivate(!1)},onConstraintRemoveClick:function(b){var c=this,d=a(b.target).closest("li"),e=d.attr("data-constraint-id");d.fadeOut("fast",function(){c.removeConstraint(e)})},setOptions:function(b){var c=this,d=c.options;a.extend(d,b),c.$container.css({"max-height":d.maxHeight+"px","z-index":d.zIndex,width:d.width}),c.checkToken(),c.selectEnrichService(),c.selectExpectedComponents(),c.setupConstraints()},checkToken:function(){var b,c=this,d=a.trim(c.options.token),e=i[d],f=function(){c.checkToken()};if(d)if(e&&a.isFunction(e.promise))switch(e.state()){case"resolved":c.enable();break;case"rejected":c.disable();break;default:e.always(f)}else b=c.options.serviceUrl,a.isFunction(b)&&(b=b.call(c.element)),i[d]=a.ajax(a.extend(c.getAjaxParams(),{url:b})).always(f)},selectEnrichService:function(){var b=this,c=b.options.type,d=a.trim(b.options.token);b.enrichService=b.options.useDadata&&c&&e.indexOf(c)>=0&&d?j.dadata:j.default},selectExpectedComponents:function(){var b=this,c=b.options.type,d=b.options.params;switch(c){case"NAME":b.expectedComponents=a.map(d&&d.parts||["surname","name","patronymic"],function(a){return a.toLowerCase()});break;case"ADDRESS":b.expectedComponents=["house"];break;default:b.expectedComponents=[]}},setupConstraints:function(){var b=this,c=b.options.constraints;c&&(b._constraintsUpdating=!0,a.each(b.constraints,a.proxy(b.removeConstraint,b)),a.each(a.makeArray(c),function(a,c){b.addConstraint(c)}),b._constraintsUpdating=!1,b.fixPosition())},fixPosition:function(){var a,b,c,d,e,f=this,g="none"==f.el.css("border-top-style")?0:parseFloat(f.el.css("border-top-width")),h="none"==f.el.css("border-left-style")?0:parseFloat(f.el.css("border-left-width"));f.el.css("paddingLeft",""),a=parseFloat(f.el.css("paddingLeft")),f.el.css("paddingLeft",a+f.$constraints.outerWidth(!0)+"px"),b=f.el.offset(),c=f.el.innerHeight(),d=f.$wrapper.offset(),e={top:b.top-d.top,left:b.left-d.left},f.$container.css({left:e.left+"px",top:e.top+g+c+"px",width:("auto"===f.options.width?f.el.outerWidth():f.options.width)+"px"}),f.$preloader.css({left:e.left+h+f.el.innerWidth()-f.$preloader.width()-parseFloat(f.el.css("paddingRight"))+"px",top:e.top+g+Math.round((c-f.$preloader.height())/2)+"px"}),f.$constraints.css({left:e.left+h+a+"px",top:e.top+g+Math.round((c-f.$constraints.height())/2)+"px"})},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.selection=null,this.suggestions=[]},disable:function(){var a=this;a.disabled=!0,a.currentRequest&&a.currentRequest.abort(),a.hide()},enable:function(){this.disabled=!1},getAjaxParams:function(){var b,d=this,e=a.trim(d.options.token);return b={type:c.getDefaultType(),dataType:"json",contentType:c.getDefaultContentType()},e&&(b.headers={Authorization:"Token "+e}),b},getQuery:function(b){var c,d=this.options.delimiter;return d?(c=b.split(d),a.trim(c[c.length-1])):b},getSuggestions:function(b){var d,e,f=this,g=f.options,h=g.serviceUrl,i=null;if(g.ignoreParams||(i=a.extend({},g.params,f.constructConstraintsParams()),i[g.paramName]=b,a.isNumeric(g.count)&&g.count>0&&(i.count=g.count)),a.isFunction(h)&&(h=h.call(f.element,b)),e=h+"?"+a.param(i||{}),d=f.cachedResponse[e],d&&a.isArray(d.suggestions))f.suggestions=d.suggestions,f.trySelectOnSpace(b),f.suggest();else if(!f.isBadQuery(b)){if(g.onSearchStart.call(f.element,i)===!1)return;f.currentRequest&&f.currentRequest.abort(),f.showPreloader(),f.currentRequest=a.ajax(a.extend(f.getAjaxParams(),{url:h,data:c.serialize(i)})).always(function(){f.currentRequest=null}).done(function(a){f.enrichService.enrichResponse.call(f,a,b).done(function(a){f.processResponse(a,b,e),g.onSearchComplete.call(f.element,b,a.suggestions),f.hidePreloader()})}).fail(function(a,c,d){g.onSearchError.call(f.element,b,a,c,d),f.hidePreloader()})}},isBadQuery:function(b){if(!this.options.preventBadQueries)return!1;var c=!1;return a.each(this.badQueries,function(a,d){return!(c=0===b.indexOf(d))}),c},verifySuggestionsFormat:function(b){return b.length&&"string"==typeof b[0]?a.map(b,function(a){return{value:a,data:null}}):b},processResponse:function(b,c,d){var e=this,f=e.options;b&&a.isArray(b.suggestions)&&(b.suggestions=e.verifySuggestionsFormat(b.suggestions),f.noCache||(e.cachedResponse[d]=b,f.preventBadQueries&&0===b.suggestions.length&&e.badQueries.push(c)),c===e.getQuery(e.currentValue)&&(e.suggestions=b.suggestions,e.trySelectOnSpace(c),e.suggest()))},showPreloader:function(){this.options.usePreloader&&this.$preloader.stop(!0).delay(50).animate({opacity:1},"fast")},hidePreloader:function(){this.options.usePreloader&&this.$preloader.stop(!0).animate({opacity:0},"fast")},getClosestSuggestionIndex:function(b){var c=this,d=a(b),e="."+c.classes.suggestion+"[data-index]";return d.is(e)||(d=d.closest(e)),d.data("index")},getSuggestionsItems:function(){return this.$container.children("."+this.classes.suggestion)},toggleDropdownEnabling:function(a){this.dropdownDisabled=!a,this.$container.attr("disabled",!a)},disableDropdown:function(){this.toggleDropdownEnabling(!1)},enableDropdown:function(){this.toggleDropdownEnabling(!0)},hasSuggestionsToChoose:function(){var b=this;return b.suggestions.length>1||1===b.suggestions.length&&(!b.selection||a.trim(b.suggestions[0].value)!=a.trim(b.selection.value))},suggest:function(){if(!this.hasSuggestionsToChoose())return void this.hide();var b=this,c=b.options,d=c.formatResult,e=a.trim(b.getQuery(b.currentValue)),f=c.beforeRender,g=[];c.hint&&b.suggestions.length&&g.push('<div class="'+b.classes.hint+'">'+c.hint+"</div>"),a.each(b.suggestions,function(a,c){g.push('<div class="'+b.classes.suggestion+'" data-index="'+a+'">'+d(c,e)+"</div>")}),b.$container.html(g.join("")),c.autoSelectFirst&&(b.selectedIndex=0,b.getSuggestionsItems().first().addClass(b.classes.selected)),a.isFunction(f)&&f.call(b.element,b.$container),b.$container.show(),b.visible=!0},hide:function(){var a=this;a.visible=!1,a.selectedIndex=-1,a.$container.hide().empty()},activate:function(b){var c,d,e=this,f=e.classes.selected;return!e.dropdownDisabled&&(d=e.getSuggestionsItems(),d.removeClass(f),e.selectedIndex=b,-1!==e.selectedIndex&&d.length>e.selectedIndex)?(c=d.get(e.selectedIndex),a(c).addClass(f),c):null},deactivate:function(a){var b=this;b.dropdownDisabled||(b.selectedIndex=-1,b.getSuggestionsItems().removeClass(b.classes.selected),a&&b.el.val(b.currentValue))},moveUp:function(){var a=this;if(!a.dropdownDisabled)return-1===a.selectedIndex?void(a.suggestions.length&&a.adjustScroll(a.suggestions.length-1)):0===a.selectedIndex?void a.deactivate(!0):void a.adjustScroll(a.selectedIndex-1)},moveDown:function(){var a=this;if(!a.dropdownDisabled)return a.selectedIndex===a.suggestions.length-1?void a.deactivate(!0):void a.adjustScroll(a.selectedIndex+1)},adjustScroll:function(a){var b,c,d,e=this,f=e.activate(a),g=25;f&&(b=f.offsetTop,c=e.$container.scrollTop(),d=c+e.options.maxHeight-g,c>b?e.$container.scrollTop(b):b>d&&e.$container.scrollTop(b-e.options.maxHeight+g),e.el.val(e.getValue(e.suggestions[a].value)))},formatConstraint:function(b){if(b&&b.restrictions){if(b.restrictions=a.makeArray(b.restrictions),!b.label){var c=[];a.each(b.restrictions,function(b,d){a.each(["kladr_id","okato","postal_code","region","area","city","settlement"],function(a,b){d[b]&&c.push(d[b])})}),b.label=c.join(", ")}return b}},addConstraint:function(b){var d,e,f=this;b=f.formatConstraint(b),b&&(e=c.uniqueId("c"),f.constraints[e]=b,d=a("<li/>").append(a("<span/>").text(b.label)).attr("data-constraint-id",e),b.deletable&&d.append(a('<span class="suggestions-remove"/>')),f.$constraints.append(d),f._constraintsUpdating||f.fixPosition())},removeConstraint:function(a){var b=this;delete b.constraints[a],b.$constraints.children('[data-constraint-id="'+a+'"]').remove(),b._constraintsUpdating||b.fixPosition()},constructConstraintsParams:function(){var b=this,c=[],d={};return a.each(b.constraints,function(a,b){c=c.concat(b.restrictions)}),c.length&&(d.restrictions=c),d},getValue:function(a){var b,c,d=this,e=d.options.delimiter;return e?(b=d.currentValue,c=b.split(e),1===c.length?a:b.substr(0,b.length-c[c.length-1].length)+a):a},isCursorAtEnd:function(){var a,b=this,c=b.el.val().length,d=b.element.selectionStart;return"number"==typeof d?d===c:document.selection?(a=document.selection.createRange(),a.moveStart("character",-c),c===a.text.length):!0},findSuggestionIndex:function(b){var c=this,d=-1,e=b.toLowerCase();return a.each(c.suggestions,function(a,b){return b.value.toLowerCase()===e?(d=a,!1):void 0}),d},selectCurrentValue:function(a){var b=this,c=b.selectedIndex,d=a&&a.noHide;if(-1===c){var e=b.getQuery(b.el.val());c=b.findSuggestionIndex(e)}-1!==c?b.select(c,a):d||b.hide()},hasAllExpectedComponents:function(b){var c=!0;return a.each(this.expectedComponents,function(a,d){return c=!!b.data[d]}),c},select:function(b,c){function d(){h?(e.selectedIndex=-1,e.getSuggestions(e.currentValue)):(e.hide(),e.suggestions=[])}var e=this,f=e.suggestions[b],g=e.options.onSelect,h=c&&c.noHide,i=c&&c.noSpace;f&&(e.currentValue=e.getValue(f.value),i||e.hasAllExpectedComponents(f)||(e.currentValue+=" "),e.el.val(e.currentValue),e.selection=f,a.isFunction(g)?e.enrichService.enrichSuggestion.call(e,f).done(function(a){g.call(e.element,a),d()}):d())},trySelectOnSpace:function(a){var b,c=this,e=/\s$/;c.options.triggerSelectOnSpace&&c._waitingForTriggerSelectOnSpace&&c._lastPressedKeyCode==d.SPACE&&e.test(a)&&(b=c.findSuggestionIndex(a.replace(e,"")),-1!==b&&(c._waitingForTriggerSelectOnSpace=!1,c.select(b,{noHide:!0})))}},a.fn.suggestions=function(c,d){return 0===arguments.length?this.first().data(g):this.each(function(){var e=a(this),f=e.data(g);"string"==typeof c?f&&"function"==typeof f[c]&&f[c](d):(f&&f.dispose&&f.dispose(),f=new b(this,c),e.data(g,f))})}});